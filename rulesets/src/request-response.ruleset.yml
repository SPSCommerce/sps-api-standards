rules:
  ##### General #####


  ##### HTTP Status Codes #####
  sps-invalid-status-code:
    description: An API MUST return HTTP response codes in conformance with RFC-2616 and common usage.
    severity: error
    given: $.paths...responses.*~
    then:
      function: enumeration
      functionOptions:
        values:
          - "200"
          - "201"
          - "202"
          - "204"
          - "400"
          - "401"
          - "403"
          - "404"
          - "405"
          - "406"
          - "409"
          - "412"
          - "415"
          - "428"
          - "429"
          - "500"

  ##### HTTP Headers #####
  sps-headers-hyphenated-pascal-case:
    description: All `HTTP` headers MUST use `Hyphenated-Pascal-Case` notation
    severity: error
    given: "$..parameters[?(@.in == 'header')].name"
    message: "'HTTP' headers MUST follow 'Hyphenated-Pascal-Case' notation"
    type: style
    then: 
      function: pattern
      functionOptions:
        match: "/^([A-Z][a-z0-9]-)*([A-Z][a-z0-9])+/"

  sps-no-x-headers:
    description: "Do not use headers with X-"
    severity: warn
    message: "Headers cannot start with X-. More: https://tools.ietf.org/html/rfc6648"
    given: "$..parameters.[?(@.in === 'header')].name"
    then:
      function: pattern
      functionOptions:
        notMatch: '^(x|X)-'
 
  sps-no-x-response-headers:
    description: "Do not use headers with X-"
    severity: warn
    message: "Headers cannot start with X-, so please find a new name for {{property}}. More: https://tools.ietf.org/html/rfc6648"
    given: "$..headers.*~"
    then:
      function: pattern
      functionOptions:
        notMatch: '^(x|X)-'

  ##### MIME Types #####

  ##### HTTP Methods #####
  sps-http-methods:
    description: Operations MUST use only the HTTP methods as outlined in the document.
    severity: error
    given: "$.paths[*][*].method"
    then:
      field: "method"
      function: enumeration
      functionOptions:
        values: ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"]

  sps-request-get-no-body:
    description: A `GET` request MUST NOT accept a request body
    severity: error
    formats: [oas3]
    given: $.paths..get.requestBody
    then:
      function: undefined
